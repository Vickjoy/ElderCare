{% extends 'elderly/base.html' %}
{% load static %}
{% block content %}
<div class="doctor-dashboard-container">
    <h1>Doctor Dashboard</h1>

    {% if current_request %}
        <div class="request-details">
            <h2>Current Request</h2>
            <p><strong>Elderly User:</strong> {{ elderly_user.first_name }} {{ elderly_user.last_name }}</p>
            <p><strong>Specialization:</strong> {{ current_request.specialization }}</p>
            <p><strong>Status:</strong> {{ current_request.status }}</p>
            <p><strong>Timestamp:</strong> {{ current_request.timestamp }}</p>
        </div>

        <div class="health-record-section">
            <h2>Health Records for {{ elderly_user.first_name }} {{ elderly_user.last_name }}</h2>
            <form method="post" action="{% url 'elderly:access_health_records' elderly_user.id %}">
                {% csrf_token %}
                <div class="form-group">
                    <h3>Medical History</h3>
                    <textarea name="medical_history" rows="4">{{ health_record.medical_history }}</textarea>
                </div>
                <div class="form-group">
                    <h3>Current Medications</h3>
                    <textarea name="current_medications" rows="4">{{ health_record.current_medications }}</textarea>
                </div>
                <div class="form-group">
                    <h3>Allergies</h3>
                    <textarea name="allergies" rows="4">{{ health_record.allergies }}</textarea>
                </div>
                <div class="form-group">
                    <h3>Health Metrics</h3>
                    <label for="blood_pressure">Blood Pressure:</label>
                    <input type="text" id="blood_pressure" name="blood_pressure" value="{{ health_record.blood_pressure }}">
                    <br>
                    <label for="heart_rate">Heart Rate:</label>
                    <input type="number" id="heart_rate" name="heart_rate" value="{{ health_record.heart_rate }}">
                    <br>
                    <label for="sugar_levels">Sugar Levels:</label>
                    <input type="number" step="0.01" id="sugar_levels" name="sugar_levels" value="{{ health_record.sugar_levels }}">
                    <br>
                    <button type="submit" class="btn-submit">Save Health Records</button>
                </div>
            </form>
        </div>

        <div class="observations-section">
            <h2>Observations</h2>
            {% if observations %}
                <ul>
                    {% for observation in observations %}
                        <li>{{ observation.notes }} ({{ observation.timestamp }})</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No observations recorded.</p>
            {% endif %}
            <form method="post" action="{% url 'elderly:record_observations' current_request.id %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="notes">Record Observation:</label>
                    <textarea name="notes" id="notes" rows="4"></textarea>
                </div>
                <button type="submit" class="btn-submit">Save Observation</button>
            </form>
        </div>

        <div class="prescriptions-section">
            <h2>Prescriptions</h2>
            {% if prescriptions %}
                <ul>
                    {% for prescription in prescriptions %}
                        <li>
                            <strong>Medication:</strong> {{ prescription.medication_name }}<br>
                            <strong>Dosage:</strong> {{ prescription.dosage }}<br>
                            <strong>Duration:</strong> {{ prescription.duration }}<br>
                            <strong>Additional Notes:</strong> {{ prescription.additional_notes }}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No prescriptions issued.</p>
            {% endif %}
            <form method="post" action="{% url 'elderly:issue_prescriptions' current_request.id %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="medication_name">Medication Name:</label>
                    <input type="text" name="medication_name" id="medication_name">
                </div>
                <div class="form-group">
                    <label for="dosage">Dosage:</label>
                    <input type="text" name="dosage" id="dosage">
                </div>
                <div class="form-group">
                    <label for="duration">Duration:</label>
                    <input type="text" name="duration" id="duration">
                </div>
                <div class="form-group">
                    <label for="additional_notes">Additional Notes:</label>
                    <textarea name="additional_notes" id="additional_notes" rows="4"></textarea>
                </div>
                <button type="submit" class="btn-submit">Issue Prescription</button>
            </form>
        </div>

        <div class="billing-section">
            <h2>Billing Information</h2>
            {% if billing %}
                <p><strong>Service Cost:</strong> ${{ billing.service_cost }}</p>
                <p><strong>Payment Status:</strong> {{ billing.payment_status }}</p>
                {% if billing.payment_status == 'pending' %}
                    <form method="post" action="{% url 'elderly:pay_now' bill_id=billing.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn-submit">Pay Now</button>
                    </form>
                {% else %}
                    <p>Payment Status: Paid</p>
                    <form method="post" action="{% url 'elderly:complete_session' current_request.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn-submit">Complete Session</button>
                    </form>
                {% endif %}
            {% else %}
                <p>No billing information specified.</p>
                <form method="post" action="{% url 'elderly:specify_service_cost' current_request.id %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="service_cost">Service Cost:</label>
                        <input type="number" step="0.01" name="service_cost" id="service_cost">
                    </div>
                    <div class="form-group">
                        <label for="paybill">Paybill:</label>
                        <input type="text" name="paybill" id="paybill" placeholder="Paybill Number">
                    </div>
                    <div class="form-group">
                        <label for="account_number">Account Number:</label>
                        <input type="text" name="account_number" id="account_number" placeholder="Account Number">
                    </div>
                    <button type="submit" class="btn-submit">Specify Service Cost</button>
                </form>
            {% endif %}
        </div>
    {% else %}
        <div class="pending-requests">
            <h2>Pending Requests</h2>
            {% if pending_requests %}
                <ul>
                    {% for request in pending_requests %}
                        <li>
                            <strong>Elderly User:</strong> {{ request.elderly_user.first_name }} {{ request.elderly_user.last_name }}<br>
                            <strong>Specialization:</strong> {{ request.specialization }}<br>
                            <strong>Status:</strong> {{ request.status }}<br>
                            <strong>Timestamp:</strong> {{ request.timestamp }}<br>
                            <form method="post" action="{% url 'elderly:accept_request' request.id %}">
                                {% csrf_token %}
                                <button type="submit" class="btn-submit">Accept Request</button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No pending requests.</p>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}